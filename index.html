<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF<li>8">
    </li>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>check</title>

    <script>
        let currentId = 22;

        let relationships = {
            "0": { "parent": null, "child": 1, "nextSibling": 3, "previousSibling": null },
            "1": { "parent": 0, "child": null, "nextSibling": 2, "previousSibling": null },
            "2": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 1 },
            "3": { "parent": null, "child": 4, "nextSibling": 16, "previousSibling": 0 },
            "4": { "parent": 3, "child": 5, "nextSibling": 17, "previousSibling": null },
            "5": { "parent": 4, "child": 6, "nextSibling": 7, "previousSibling": null },
            "6": { "parent": 5, "child": null, "nextSibling": 8, "previousSibling": null },
            "7": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 5 },
            "8": { "parent": null, "child": 9, "nextSibling": null, "previousSibling": 6 },
            "9": { "parent": 8, "child": null, "nextSibling": null, "previousSibling": null },
            "10": { "parent": null, "child": null, "nextSibling": null, "previousSibling": null },
            "11": { "parent": null, "child": null, "nextSibling": null, "previousSibling": null },
            "12": { "parent": null, "child": 13, "nextSibling": 14, "previousSibling": null },
            "13": { "parent": 12, "child": null, "nextSibling": 15, "previousSibling": null },
            "14": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 12 },
            "15": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 13 },
            "16": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 3 },
            "17": { "parent": null, "child": 18, "nextSibling": 20, "previousSibling": 4 },
            "18": { "parent": 17, "child": null, "nextSibling": 19, "previousSibling": null },
            "19": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 18 },
            "20": { "parent": null, "child": 21, "nextSibling": null, "previousSibling": 17 },
            "21": { "parent": 20, "child": null, "nextSibling": 22, "previousSibling": null },
            "22": { "parent": null, "child": null, "nextSibling": null, "previousSibling": 21 },
        };

        let nodes = {
            "0": { "id": "0", "title": "Music" },
            "1": { "id": "1", "title": "Offended" },
            "2": { "id": "2", "title": "Krystal" },
            "3": { "id": "3", "title": "Code" },
            "4": { "id": "4", "title": "Check" },
            "5": { "id": "5", "title": "Set up the data" },
            "6": { "id": "6", "title": "Scaffold in markdown" },
            "7": { "id": "7", "title": "Mock this in JSON" },
            "8": { "id": "8", "title": "Given json data (entities + relationships) render the page" },
            "9": { "id": "9", "title": "Render the node " },
            "10": { "id": "10", "title": "render its child" },
            "11": { "id": "11", "title": "render its sibling" },
            "12": { "id": "12", "title": "Structure the page" },
            "13": { "id": "13", "title": "Scaffold out html" },
            "14": { "id": "14", "title": "Implement the logic" },
            "15": { "id": "15", "title": "Recording/Editing process" },
            "16": { "id": "16", "title": "Personal Site" },
            "17": { "id": "17", "title": "Activities" },
            "18": { "id": "18", "title": "Go to cafe" },
            "19": { "id": "19", "title": "Go for a walk" },
            "20": { "id": "20", "title": "Admin" },
            "21": { "id": "21", "title": "Contact local ISKF chapter to meet and see if I can train/instruct" },
            "22": { "id": "22", "title": "Set up a free trial at one competitive" }
        };

        function renderItem(node) {
            //------------ render node text ---------------
            let nodeElement = document.createElement('li');
            nodeElement.id = node.id;
            nodeElement.textContent = node.title + ' ';

            //-------- render add-sibling button -----------
            let addButton = document.createElement('button');
            addButton.textContent = 'Add Sibling Item';
            nodeElement.appendChild(addButton);

            // wire add sibling button to do the needful
            addButton.onclick = () => {
                let title = prompt("Please enter a title for the new item: ");

                let newNode = addSibling(title, node);
                let newNodeElement = renderItem(newNode);

                let oldSiblingElement = nodeElement.nextSibling;

                if (oldSiblingElement) {
                    oldSiblingElement.parentElement.insertBefore(newNodeElement, oldSiblingElement);
                } else {
                    nodeElement.parentElement.appendChild(newNodeElement);
                }
            };

            //------------ render delete button ------------
            let deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete Item';
            nodeElement.appendChild(deleteButton);

            // wire delete button to do the needful
            deleteButton.onclick = () => {
                deleteNode(node);
                nodeElement.remove();
            };

            return nodeElement;
        }

        function renderList(parentElement, node) {
            let nodeElement = renderItem(node);
            parentElement.appendChild(nodeElement);

            //========= RENDER CHILDREN RECURSIVELY =====
            let childID = relationships[node.id].child;
            if (childID) {
                let ol = document.createElement('ol');
                nodeElement.appendChild(ol);
                renderList(ol, nodes[childID]);
            }

            //========= RENDER SIBLINGS RECURSIVELY =====
            let siblingID = relationships[node.id].nextSibling;
            if (siblingID) {
                renderList(parentElement, nodes[siblingID]);
            }
        }

        function addSibling(title, targetNode) {
            let newNode = { 'id': ++currentId, 'title': title };
            let nextSibling = relationships[targetNode.id].nextSibling;

            // point newNode to targetNode
            relationships[newNode.id] = {};
            relationships[newNode.id].previousSibling = targetNode.id;
            relationships[newNode.id].nextSibling = nextSibling;

            relationships[targetNode.id].nextSibling  = newNode.id;
            // meet the sibling you are replacing if they exist
            if (nextSibling) {
                relationships[nextSibling].previousSibling = newNode.id;
            }

            // point the targetNode at the newNode
            relationships[targetNode.id].nextSibling = newNode.id;

            return newNode;
        }

        function deleteNode(targetNode) {
            let parentID = relationships[targetNode.id].parent;
            let previousSibling = relationships[targetNode.id].previousSibling;
            let nextSibling = relationships[targetNode.id].nextSibling;

            //if this node was the first-born/eldest it needs to pass the gauntlet
            if (nextSibling && parentID) {
                relationships[parentID].child = nextSibling;
                relationships[nextSibling].parent = parentID;
                relationships[nextSibling].previousSibling = null;
            }

            //if this node was the middle child it needs to link it's siblings
            if (previousSibling && nextSibling) {
                relationships[previousSibling].nextSibling = nextSibling;
                relationships[nextSibling].previousSibling = previousSibling;
            }

            //if this node was the youngest
            if (previousSibling && !nextSibling) {
                relationships[previousSibling].nextSibling = null;
            }

            //free up the memory
            delete relationships[targetNode.id];
        }

        window.onload = function () {
            let rootList = document.createElement('ol');
            let body = document.getElementsByTagName('body')[0];

            body.appendChild(rootList);

            renderList(rootList, nodes['0']);
        };

    </script>
</head>

<body>
</body>

</html>